{"ts":1372364098636,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":false,"ts":1372364136941,"patch":[[{"diffs":[[1,"<%#\nLuCI - Lua Configuration Interface\nCopyright 2008 Steven Barth <steven@midlink.org>\nCopyright 2008 Jo-Philipp Wich <xm@leipzig.freifunk.net>\nCopyright 2012 David Menting <david@nut-bolt.nl>\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\n-%>\n<%\n\tlocal sys  = require \"luci.sys\"\n\tlocal http = require \"luci.http\"\n\tlocal disp = require \"luci.dispatcher\"\n\n\tlocal hostname = sys.hostname()\n\n\tlocal request  = disp.context.path\n\tlocal request2 = disp.context.request\n\n\tlocal category = request[1]\n\tlocal cattree  = category and disp.node(category)\n\n\tlocal leaf = request2[#request2]\n\n\tlocal tree = disp.node()\n\tlocal node = disp.context.dispatched\n\n\tlocal categories = disp.node_childs(tree)\n\n\tlocal c = tree\n\tlocal i, r\n\n\t-- tag all nodes leading to this page\n\tfor i, r in ipairs(request) do\n\t\tif c.nodes and c.nodes[r] then\n\t\t\tc = c.nodes[r]\n\t\t\tc._menu_selected = true\n\t\tend\n\tend\n    \n    -- send as HTML5\n\thttp.prepare_content(\"text/html\")\n\n\tlocal function nodeurl(prefix, name, query)\n\t\tlocal url = controller .. prefix .. name .. \"/\"\n\t\tif query then\n\t\t\turl = url .. http.build_querystring(query)\n\t\tend\n\t\treturn pcdata(url)\n\tend\n\n\tlocal function subtree(prefix, node, level)\n\t\tif not level then\n\t\t\tlevel = 1\n\t\tend\n\n\t\tlocal childs = disp.node_childs(node)\n\t\tif #childs > 0 then\n        \n            if level > 2 then\n%>\n\t<ul class=\"tabs\">\n\t\t<%  \n            end\n\n\t\t\tlocal selected_node\n\t\t\tlocal selected_name\n\t\t\tlocal i, v\n\n\t\t\tfor i, v in ipairs(childs) do\n\t\t\t\tlocal nnode = node.nodes[v]\n\t\t\t\tif nnode._menu_selected then\n\t\t\t\t\tselected_node = nnode\n\t\t\t\t\tselected_name = v\n\t\t\t\tend\n                if level > 2 then\n\t\t%>\n\t\t\t<li class=\"tabmenu-item-<%=v%> <%- if nnode._menu_selected or (node.leaf and v == leaf) then -%> active<% end %>\">\n\t\t\t    <a href=\"<%=nodeurl(prefix, v, nnode.query)%>\"><%=striptags(translate(nnode.title))%></a>\n\t\t\t</li>\n\t\t<%      end\n\t\t\tend\n            \n            if level > 2 then\n\t\t%>\n\t</ul>\n<%          end\n\n\t\t\tif selected_node then\n\t\t\t\tsubtree(prefix .. selected_name .. \"/\", selected_node, level + 1)\n\t\t\tend\n\t\tend\n\tend\n-%>\n<!DOCTYPE html>\n<html lang=\"<%=luci.i18n.context.lang%>\">\n  <head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no\" />\n    <title><%=striptags( hostname .. ( (node and node.title) and ' - ' .. translate(node.title) or '')) %> - LuCI</title>\n    <!--[if lt IE 9]><script src=\"<%=media%>/html5.js\"></script><![endif]-->\n    <link rel=\"stylesheet\" href=\"<%=media%>/cascade.css\">\n    <link rel=\"shortcut icon\" href=\"<%=media%>/favicon.ico\">\n    <% if node and node.css then %>\n    <link rel=\"stylesheet\" href=\"<%=resource%>/<%=node.css%>\">\n    <% end -%>\n    <script src=\"<%=resource%>/xhr.js\"></script>\n  </head>\n\n  <body class=\"lang_<%=luci.i18n.context.lang%> <%- if node then %><%= striptags( node.title ) %><%- end %>\">\n    <header>\n      <nav>\n        <ul id=\"navtoselect\">\n          <%-\n          local function submenu(prefix, node)\n          local childs = disp.node_childs(node)\n          if #childs > 0 then\n          %>\n          <ul class=\"dropdown-menu\">\n            <%-\n            for i, r in ipairs(childs) do\n            local nnode = node.nodes[r]\n            local href  = controller .. prefix .. r ..\n            (nnode.query and http.build_querystring(nnode.query) or \"\")\n            %>\n            <li>\n              <a href=\"<%=pcdata(href)%>\"><%=pcdata(striptags(translate(nnode.title)))%></a>\n            </li>\n            <%-\n            end\n            %>\n          </ul>\n          <%-\n          end\n          end\n\n          childs = disp.node_childs(cattree)\n\n          if #childs > 0 then\n          for i, r in ipairs(childs) do\n          local nnode = cattree.nodes[r]\n          local href  = controller .. \"/\" .. category .. \"/\" .. r ..\n          (nnode.query and http.build_querystring(k.query) or \"\")\n          local grandchildren = disp.node_childs(nnode)\n\n          if #grandchildren > 0 then\n          %>\n          <li class=\"dropdown\">\n            <a class=\"menu\" href=\"<%=pcdata(href)%>\"><%=pcdata(striptags(translate(nnode.title)))%></a>\n            <%- submenu(\"/\" .. category .. \"/\" .. r .. \"/\", nnode) %>\n          </li>\n          <% else %>\n          <li>\n            <a href=\"<%=pcdata(href)%>\"><%=pcdata(striptags(translate(nnode.title)))%></a>\n          </li>\n          <%\n          end\n          end\n          end\n          %>\n        </ul>\n      </nav>\n\n      <a id=\"device\" href=\"/\"><img src=\"<%=media%>/commotion_tiny.png\" alt=\"Commotion - toggle header\" title=\"Commotion - toggle header\" /></a>\n\n      <div class=\"collapsible\">\n        <h1 class=\"brand\"><a href=\"/\">Node name: <%=hostname%></a></h1>\n      </div>\n    </header>\n\n    <div class=\"messages\">\n      <%\n      -- calculate the number of unsaved changes\n      if tree.nodes[category] and tree.nodes[category].ucidata then\n        local ucichanges = 0\n\n        for i, j in pairs(require(\"luci.model.uci\").cursor():changes()) do\n        for k, l in pairs(j) do\n        for m, n in pairs(l) do\n        ucichanges = ucichanges + 1;\n        end\n        end\n        end\n\n        if ucichanges > 0 then\n        %>\n          <a class=\"label notice\" href=\"<%=controller%>/<%=category%>/uci/changes\"><%:Unsaved Changes%>: <%=ucichanges%></a>\n        <%\n        end\n        %>\n      <%\n      end\n      %>\n      <span id=\"xhr_poll_status\" style=\"display:none\" onclick=\"XHR.running() ? XHR.halt() : XHR.run()\">\n        <span class=\"label success\" id=\"xhr_poll_status_on\"><%:Auto Refresh%> <%:on%></span>\n        <span class=\"label\" id=\"xhr_poll_status_off\" style=\"display:none\"><%:Auto Refresh%> <%:off%></span>\n      </span>\n    </div>\n\n    <div class=\"navbar-inners\"><div class=\"color0\"></div><div class=\"color1\"></div><div class=\"color2\"></div><div class=\"color3\"></div><div class=\"color4\"></div></div>\n\n    <%- if luci.sys.user.getuser(\"root\") and not luci.sys.user.getpasswd(\"root\") then -%>\n    <section class=\"alerts\">\n      <div class=\"alert warning\">\n      <h4><%:No password set!%></h4>\n      <p>\n        <%:There is no password set on this router. Please configure a root password to protect the web interface and enable SSH.%>\n      </p>\n      <p>\n        <a href=\"<%=pcdata(luci.dispatcher.build_url(\"admin/system/admin\"))%>\"><%:Go to password configuration...%></a>\n      </p>\n      </div>\n    </section>\n    <%- end -%>\n\n    <section id=\"maincontent\">\n\n    <% if category then subtree(\"/\" .. category .. \"/\", cattree) end %>\n"]],"start1":0,"start2":0,"length1":0,"length2":6662}]],"length":6662,"saved":false}
